<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="417px" preserveAspectRatio="none" style="width:1754px;height:417px;" version="1.1" viewBox="0 0 1754 417" width="1754px" zoomAndPan="magnify"><defs><filter height="300%" id="funzrpp6p6zj" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="365" x="695.25" y="22.9951">"for an IoT device to join the FogFlow system"</text><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="55" x2="55" y1="68.5938" y2="376.7891"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="322" x2="322" y1="68.5938" y2="376.7891"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="634.5" x2="634.5" y1="68.5938" y2="376.7891"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1017.5" x2="1017.5" y1="68.5938" y2="376.7891"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1572.5" x2="1572.5" y1="68.5938" y2="376.7891"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1695.5" x2="1695.5" y1="68.5938" y2="376.7891"/><rect fill="#FEFECE" filter="url(#funzrpp6p6zj)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="91" x="8" y="33.2969"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="77" x="15" y="53.292">NewDevice</text><rect fill="#FEFECE" filter="url(#funzrpp6p6zj)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="91" x="8" y="375.7891"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="77" x="15" y="395.7842">NewDevice</text><rect fill="#FEFECE" filter="url(#funzrpp6p6zj)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="121" x="260" y="33.2969"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="107" x="267" y="53.292">CloudDiscovery</text><rect fill="#FEFECE" filter="url(#funzrpp6p6zj)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="121" x="260" y="375.7891"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="107" x="267" y="395.7842">CloudDiscovery</text><rect fill="#FEFECE" filter="url(#funzrpp6p6zj)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="108" x="578.5" y="33.2969"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="94" x="585.5" y="53.292">NearbyBroker</text><rect fill="#FEFECE" filter="url(#funzrpp6p6zj)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="108" x="578.5" y="375.7891"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="94" x="585.5" y="395.7842">NearbyBroker</text><rect fill="#FEFECE" filter="url(#funzrpp6p6zj)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="112" x="959.5" y="33.2969"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="98" x="966.5" y="53.292">localDiscovery</text><rect fill="#FEFECE" filter="url(#funzrpp6p6zj)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="112" x="959.5" y="375.7891"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="98" x="966.5" y="395.7842">localDiscovery</text><rect fill="#FEFECE" filter="url(#funzrpp6p6zj)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="120" x="1510.5" y="33.2969"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="106" x="1517.5" y="53.292">OtherDiscovery</text><rect fill="#FEFECE" filter="url(#funzrpp6p6zj)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="120" x="1510.5" y="375.7891"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="106" x="1517.5" y="395.7842">OtherDiscovery</text><rect fill="#FEFECE" filter="url(#funzrpp6p6zj)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="99" x="1644.5" y="33.2969"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="85" x="1651.5" y="53.292">OtherBroker</text><rect fill="#FEFECE" filter="url(#funzrpp6p6zj)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="99" x="1644.5" y="375.7891"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="85" x="1651.5" y="395.7842">OtherBroker</text><polygon fill="#A80036" points="310.5,95.7266,320.5,99.7266,310.5,103.7266,314.5,99.7266" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="55.5" x2="316.5" y1="99.7266" y2="99.7266"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="62.5" y="94.6606">1</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="186" x="75.5" y="94.6606">HTTP request /join(location x)</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="322.5" x2="364.5" y1="128.8594" y2="128.8594"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="364.5" x2="364.5" y1="128.8594" y2="141.8594"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="323.5" x2="364.5" y1="141.8594" y2="141.8594"/><polygon fill="#A80036" points="333.5,137.8594,323.5,141.8594,333.5,145.8594,329.5,141.8594" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="329.5" y="123.7935">2</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="285" x="342.5" y="123.7935">find a nearby site from the global routing tab</text><polygon fill="#A80036" points="66.5,166.9922,56.5,170.9922,66.5,174.9922,62.5,170.9922" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="60.5" x2="321.5" y1="170.9922" y2="170.9922"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="72.5" y="165.9263">3</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="230" x="85.5" y="165.9263">a nearby site with the nearby broker</text><polygon fill="#A80036" points="622.5,196.125,632.5,200.125,622.5,204.125,626.5,200.125" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="55.5" x2="628.5" y1="200.125" y2="200.125"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="62.5" y="195.0591">4</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="368" x="75.5" y="195.0591">interact with the nearby broker (update, query, subscribe)</text><polygon fill="#A80036" points="1005.5,225.2578,1015.5,229.2578,1005.5,233.2578,1009.5,229.2578" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="634.5" x2="1011.5" y1="229.2578" y2="229.2578"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="641.5" y="224.1919">5</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="49" x="654.5" y="224.1919">interact</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="1017.5" x2="1059.5" y1="258.3906" y2="258.3906"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1059.5" x2="1059.5" y1="258.3906" y2="271.3906"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1018.5" x2="1059.5" y1="271.3906" y2="271.3906"/><polygon fill="#A80036" points="1028.5,267.3906,1018.5,271.3906,1028.5,275.3906,1024.5,271.3906" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="1024.5" y="253.3247">6</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="183" x="1037.5" y="253.3247">look up from the global table</text><polygon fill="#A80036" points="1028.5,296.5234,1018.5,300.5234,1028.5,304.5234,1024.5,300.5234" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="1560.5,296.5234,1570.5,300.5234,1560.5,304.5234,1564.5,300.5234" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1022.5" x2="1566.5" y1="300.5234" y2="300.5234"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="1034.5" y="295.4575">7</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="518" x="1047.5" y="295.4575">interact with other discovery components to figure out which broker for this entity</text><polygon fill="#A80036" points="645.5,325.6563,635.5,329.6563,645.5,333.6563,641.5,329.6563" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="639.5" x2="1016.5" y1="329.6563" y2="329.6563"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="651.5" y="324.5903">8</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="346" x="664.5" y="324.5903">the broke(s) to save/query/subscribe matched entities</text><polygon fill="#A80036" points="645.5,354.7891,635.5,358.7891,645.5,362.7891,641.5,358.7891" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="1684,354.7891,1694,358.7891,1684,362.7891,1688,358.7891" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="639.5" x2="1690" y1="358.7891" y2="358.7891"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="651.5" y="353.7231">9</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="288" x="664.5" y="353.7231">interact with them (update, query, subscribe)</text><!--
@startuml
title "for an IoT device to join the FogFlow system"

autonumber

NewDevice -> CloudDiscovery :  HTTP request /join(location x)

CloudDiscovery -> CloudDiscovery: find a nearby site from the global routing tab 

CloudDiscovery -> NewDevice: a nearby site with the nearby broker

NewDevice -> NearbyBroker: interact with the nearby broker (update, query, subscribe)

NearbyBroker -> localDiscovery: interact

localDiscovery <-> localDiscovery: look up from the global table

localDiscovery <-> OtherDiscovery: interact with other discovery components to figure out which broker for this entity

localDiscovery -> NearbyBroker: the broke(s) to save/query/subscribe matched entities

NearbyBroker <-> OtherBroker: interact with them (update, query, subscribe)
@enduml

PlantUML version 1.2018.09(Fri Jul 27 16:58:18 UTC 2018)
(GPL source distribution)
Java Runtime: Java(TM) SE Runtime Environment
JVM: Java HotSpot(TM) 64-Bit Server VM
Java Version: 1.7.0_25-b15
Operating System: Linux
Default Encoding: UTF-8
Language: en
Country: US
--></g></svg>