<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="1256px" preserveAspectRatio="none" style="width:1485px;height:1256px;" version="1.1" viewBox="0 0 1485 1256" width="1485px" zoomAndPan="magnify"><defs><filter height="300%" id="fkibif8axfdzf" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="104" x="686" y="22.9951">"queryEntity"</text><rect fill="#DDDDDD" height="1211.2422" style="stroke: #A80036; stroke-width: 1.0;" width="411" x="367.5" y="34.2969"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="66" x="540" y="46.3638">LocalSite</text><rect fill="#ADD8E6" height="1211.2422" style="stroke: #A80036; stroke-width: 1.0;" width="277" x="1195" y="34.2969"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="93" x="1287" y="46.3638">RemoteSites</text><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="30" x2="30" y1="88.7266" y2="1207.2422"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="427.5" x2="427.5" y1="88.7266" y2="1207.2422"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="714.5" x2="714.5" y1="88.7266" y2="1207.2422"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1258" x2="1258" y1="88.7266" y2="1207.2422"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1398" x2="1398" y1="88.7266" y2="1207.2422"/><rect fill="#FEFECE" filter="url(#fkibif8axfdzf)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="41" x="8" y="53.4297"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="27" x="15" y="73.4248">App</text><rect fill="#FEFECE" filter="url(#fkibif8axfdzf)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="41" x="8" y="1206.2422"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="27" x="15" y="1226.2373">App</text><rect fill="#FEFECE" filter="url(#fkibif8axfdzf)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="108" x="371.5" y="53.4297"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="94" x="378.5" y="73.4248">NearbyBroker</text><rect fill="#FEFECE" filter="url(#fkibif8axfdzf)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="108" x="371.5" y="1206.2422"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="94" x="378.5" y="1226.2373">NearbyBroker</text><rect fill="#FEFECE" filter="url(#fkibif8axfdzf)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="116" x="654.5" y="53.4297"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="102" x="661.5" y="73.4248">LocalDiscovery</text><rect fill="#FEFECE" filter="url(#fkibif8axfdzf)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="116" x="654.5" y="1206.2422"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="102" x="661.5" y="1226.2373">LocalDiscovery</text><rect fill="#FEFECE" filter="url(#fkibif8axfdzf)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="115" x="1199" y="53.4297"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="101" x="1206" y="73.4248">RemoteBroker</text><rect fill="#FEFECE" filter="url(#fkibif8axfdzf)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="115" x="1199" y="1206.2422"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="101" x="1206" y="1226.2373">RemoteBroker</text><rect fill="#FEFECE" filter="url(#fkibif8axfdzf)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="136" x="1328" y="53.4297"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="122" x="1335" y="73.4248">RemoteDiscovery</text><rect fill="#FEFECE" filter="url(#fkibif8axfdzf)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="136" x="1328" y="1206.2422"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="122" x="1335" y="1226.2373">RemoteDiscovery</text><rect fill="#EEEEEE" filter="url(#fkibif8axfdzf)" height="3" style="stroke: #EEEEEE; stroke-width: 1.0;" width="1470" x="3" y="119.293"/><line style="stroke: #000000; stroke-width: 1.0;" x1="3" x2="1473" y1="119.293" y2="119.293"/><line style="stroke: #000000; stroke-width: 1.0;" x1="3" x2="1473" y1="122.293" y2="122.293"/><rect fill="#EEEEEE" filter="url(#fkibif8axfdzf)" height="23.1328" style="stroke: #000000; stroke-width: 2.0;" width="285" x="595.5" y="108.7266"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="266" x="601.5" y="124.7935">query entities with a polygon Scope</text><polygon fill="#A80036" points="415.5,158.9922,425.5,162.9922,415.5,166.9922,419.5,162.9922" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="30.5" x2="421.5" y1="162.9922" y2="162.9922"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="37.5" y="157.9263">1</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="289" x="50.5" y="157.9263">NGSI10 query entities with Scope S (polygon)</text><polygon fill="#A80036" points="702.5,188.125,712.5,192.125,702.5,196.125,706.5,192.125" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="427.5" x2="708.5" y1="192.125" y2="192.125"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="434.5" y="187.0591">2</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="114" x="447.5" y="187.0591">NGSI9 query for S</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="714.5" x2="756.5" y1="221.2578" y2="221.2578"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="756.5" x2="756.5" y1="221.2578" y2="234.2578"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="715.5" x2="756.5" y1="234.2578" y2="234.2578"/><polygon fill="#A80036" points="725.5,230.2578,715.5,234.2578,725.5,238.2578,721.5,234.2578" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="721.5" y="216.1919">3</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="471" x="734.5" y="216.1919">look up the routing table to identify which Discoverys are responsible for S</text><polygon fill="#A80036" points="1386,259.3906,1396,263.3906,1386,267.3906,1390,263.3906" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="714.5" x2="1392" y1="263.3906" y2="263.3906"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="721.5" y="258.3247">4</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="158" x="734.5" y="258.3247">query all other Discovery</text><polygon fill="#A80036" points="725.5,288.5234,715.5,292.5234,725.5,296.5234,721.5,292.5234" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="719.5" x2="1397" y1="292.5234" y2="292.5234"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="731.5" y="287.4575">5</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="167" x="744.5" y="287.4575">combine the query results</text><polygon fill="#A80036" points="438.5,317.6563,428.5,321.6563,438.5,325.6563,434.5,321.6563" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="432.5" x2="713.5" y1="321.6563" y2="321.6563"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="444.5" y="316.5903">6</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="241" x="457.5" y="316.5903">&lt;ID, brokerIP&gt; of all matched entities</text><polygon fill="#A80036" points="1246.5,346.7891,1256.5,350.7891,1246.5,354.7891,1250.5,350.7891" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="427.5" x2="1252.5" y1="350.7891" y2="350.7891"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="434.5" y="345.7231">7</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="169" x="447.5" y="345.7231">fetch the matched entities</text><polygon fill="#A80036" points="41.5,375.9219,31.5,379.9219,41.5,383.9219,37.5,379.9219" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="35.5" x2="426.5" y1="379.9219" y2="379.9219"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="47.5" y="374.856">8</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="176" x="60.5" y="374.856">return the matched entities</text><rect fill="#EEEEEE" filter="url(#fkibif8axfdzf)" height="3" style="stroke: #EEEEEE; stroke-width: 1.0;" width="1470" x="3" y="408.4883"/><line style="stroke: #000000; stroke-width: 1.0;" x1="3" x2="1473" y1="408.4883" y2="408.4883"/><line style="stroke: #000000; stroke-width: 1.0;" x1="3" x2="1473" y1="411.4883" y2="411.4883"/><rect fill="#EEEEEE" filter="url(#fkibif8axfdzf)" height="23.1328" style="stroke: #000000; stroke-width: 2.0;" width="260" x="608" y="397.9219"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="241" x="614" y="413.9888">query entities with a local Scope</text><polygon fill="#A80036" points="415.5,448.1875,425.5,452.1875,415.5,456.1875,419.5,452.1875" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="30.5" x2="421.5" y1="452.1875" y2="452.1875"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="37.5" y="447.1216">9</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="255" x="50.5" y="447.1216">NGSI10 query entities with Scope (local)</text><polygon fill="#A80036" points="702.5,477.3203,712.5,481.3203,702.5,485.3203,706.5,481.3203" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="427.5" x2="708.5" y1="481.3203" y2="481.3203"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="434.5" y="476.2544">10</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="114" x="456.5" y="476.2544">NGSI9 query for S</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="714.5" x2="756.5" y1="510.4531" y2="510.4531"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="756.5" x2="756.5" y1="510.4531" y2="523.4531"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="715.5" x2="756.5" y1="523.4531" y2="523.4531"/><polygon fill="#A80036" points="725.5,519.4531,715.5,523.4531,725.5,527.4531,721.5,523.4531" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="721.5" y="505.3872">11</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="158" x="743.5" y="505.3872">look up matched entities</text><polygon fill="#A80036" points="438.5,548.5859,428.5,552.5859,438.5,556.5859,434.5,552.5859" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="432.5" x2="713.5" y1="552.5859" y2="552.5859"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="444.5" y="547.52">12</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="241" x="466.5" y="547.52">&lt;ID, brokerIP&gt; of all matched entities</text><polygon fill="#A80036" points="1246.5,577.7188,1256.5,581.7188,1246.5,585.7188,1250.5,581.7188" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="427.5" x2="1252.5" y1="581.7188" y2="581.7188"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="434.5" y="576.6528">13</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="169" x="456.5" y="576.6528">fetch the matched entities</text><polygon fill="#A80036" points="41.5,606.8516,31.5,610.8516,41.5,614.8516,37.5,610.8516" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="35.5" x2="426.5" y1="610.8516" y2="610.8516"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="47.5" y="605.7856">14</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="176" x="69.5" y="605.7856">return the matched entities</text><rect fill="#EEEEEE" filter="url(#fkibif8axfdzf)" height="3" style="stroke: #EEEEEE; stroke-width: 1.0;" width="1470" x="3" y="639.418"/><line style="stroke: #000000; stroke-width: 1.0;" x1="3" x2="1473" y1="639.418" y2="639.418"/><line style="stroke: #000000; stroke-width: 1.0;" x1="3" x2="1473" y1="642.418" y2="642.418"/><rect fill="#EEEEEE" filter="url(#fkibif8axfdzf)" height="23.1328" style="stroke: #000000; stroke-width: 2.0;" width="272" x="602" y="628.8516"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="253" x="608" y="644.9185">query entities with a global Scope</text><polygon fill="#A80036" points="415.5,679.1172,425.5,683.1172,415.5,687.1172,419.5,683.1172" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="30.5" x2="421.5" y1="683.1172" y2="683.1172"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="37.5" y="678.0513">15</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="327" x="59.5" y="678.0513">NGSI10 query entities with Scope S (global), topic T</text><polygon fill="#A80036" points="702.5,708.25,712.5,712.25,702.5,716.25,706.5,712.25" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="427.5" x2="708.5" y1="712.25" y2="712.25"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="434.5" y="707.1841">16</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="180" x="456.5" y="707.1841">NGSI9 query for &lt;global, T&gt;</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="714.5" x2="756.5" y1="741.3828" y2="741.3828"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="756.5" x2="756.5" y1="741.3828" y2="754.3828"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="715.5" x2="756.5" y1="754.3828" y2="754.3828"/><polygon fill="#A80036" points="725.5,750.3828,715.5,754.3828,725.5,758.3828,721.5,754.3828" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="721.5" y="736.3169">17</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="504" x="743.5" y="736.3169">look up the routing table to identify which Discoverys are responsible for topic T</text><polygon fill="#A80036" points="1386,779.5156,1396,783.5156,1386,787.5156,1390,783.5156" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="714.5" x2="1392" y1="783.5156" y2="783.5156"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="721.5" y="778.4497">18</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="158" x="743.5" y="778.4497">query all other Discovery</text><polygon fill="#A80036" points="725.5,808.6484,715.5,812.6484,725.5,816.6484,721.5,812.6484" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="719.5" x2="1397" y1="812.6484" y2="812.6484"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="731.5" y="807.5825">19</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="167" x="753.5" y="807.5825">combine the query results</text><polygon fill="#A80036" points="438.5,837.7813,428.5,841.7813,438.5,845.7813,434.5,841.7813" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="432.5" x2="713.5" y1="841.7813" y2="841.7813"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="444.5" y="836.7153">20</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="241" x="466.5" y="836.7153">&lt;ID, brokerIP&gt; of all matched entities</text><polygon fill="#A80036" points="1246.5,866.9141,1256.5,870.9141,1246.5,874.9141,1250.5,870.9141" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="427.5" x2="1252.5" y1="870.9141" y2="870.9141"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="434.5" y="865.8481">21</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="169" x="456.5" y="865.8481">fetch the matched entities</text><polygon fill="#A80036" points="41.5,896.0469,31.5,900.0469,41.5,904.0469,37.5,900.0469" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="35.5" x2="426.5" y1="900.0469" y2="900.0469"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="47.5" y="894.981">22</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="176" x="69.5" y="894.981">return the matched entities</text><rect fill="#EEEEEE" filter="url(#fkibif8axfdzf)" height="3" style="stroke: #EEEEEE; stroke-width: 1.0;" width="1470" x="3" y="928.6133"/><line style="stroke: #000000; stroke-width: 1.0;" x1="3" x2="1473" y1="928.6133" y2="928.6133"/><line style="stroke: #000000; stroke-width: 1.0;" x1="3" x2="1473" y1="931.6133" y2="931.6133"/><rect fill="#EEEEEE" filter="url(#fkibif8axfdzf)" height="23.1328" style="stroke: #000000; stroke-width: 2.0;" width="369" x="553.5" y="918.0469"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="355" x="559.5" y="934.1138">query entities with a polygon Scope and a topic</text><polygon fill="#A80036" points="415.5,968.3125,425.5,972.3125,415.5,976.3125,419.5,972.3125" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="30.5" x2="421.5" y1="972.3125" y2="972.3125"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="37.5" y="967.2466">23</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="351" x="59.5" y="967.2466">NGSI10 query entities with Scope S (polygon), Topic (T)</text><polygon fill="#A80036" points="702.5,997.4453,712.5,1001.4453,702.5,1005.4453,706.5,1001.4453" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="427.5" x2="708.5" y1="1001.4453" y2="1001.4453"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="434.5" y="996.3794">24</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="151" x="456.5" y="996.3794">NGSI9 query for &lt;S, T&gt;</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="714.5" x2="756.5" y1="1030.5781" y2="1030.5781"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="756.5" x2="756.5" y1="1030.5781" y2="1043.5781"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="715.5" x2="756.5" y1="1043.5781" y2="1043.5781"/><polygon fill="#A80036" points="725.5,1039.5781,715.5,1043.5781,725.5,1047.5781,721.5,1043.5781" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="721.5" y="1025.5122">25</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="508" x="743.5" y="1025.5122">look up the routing table to identify which Discoverys are responsible for &lt;S, T&gt;</text><polygon fill="#A80036" points="1386,1068.7109,1396,1072.7109,1386,1076.7109,1390,1072.7109" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="714.5" x2="1392" y1="1072.7109" y2="1072.7109"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="721.5" y="1067.645">26</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="158" x="743.5" y="1067.645">query all other Discovery</text><polygon fill="#A80036" points="725.5,1097.8438,715.5,1101.8438,725.5,1105.8438,721.5,1101.8438" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="719.5" x2="1397" y1="1101.8438" y2="1101.8438"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="731.5" y="1096.7778">27</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="167" x="753.5" y="1096.7778">combine the query results</text><polygon fill="#A80036" points="438.5,1126.9766,428.5,1130.9766,438.5,1134.9766,434.5,1130.9766" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="432.5" x2="713.5" y1="1130.9766" y2="1130.9766"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="444.5" y="1125.9106">28</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="241" x="466.5" y="1125.9106">&lt;ID, brokerIP&gt; of all matched entities</text><polygon fill="#A80036" points="1246.5,1156.1094,1256.5,1160.1094,1246.5,1164.1094,1250.5,1160.1094" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="427.5" x2="1252.5" y1="1160.1094" y2="1160.1094"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="434.5" y="1155.0435">29</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="169" x="456.5" y="1155.0435">fetch the matched entities</text><polygon fill="#A80036" points="41.5,1185.2422,31.5,1189.2422,41.5,1193.2422,37.5,1189.2422" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="35.5" x2="426.5" y1="1189.2422" y2="1189.2422"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="47.5" y="1184.1763">30</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="176" x="69.5" y="1184.1763">return the matched entities</text><!--
@startuml
title "queryEntity"

autonumber

== query entities with a polygon Scope ==

App -> NearbyBroker: NGSI10 query entities with Scope S (polygon)

NearbyBroker -> LocalDiscovery: NGSI9 query for S
LocalDiscovery -> LocalDiscovery: look up the routing table to identify which Discoverys are responsible for S
LocalDiscovery -> RemoteDiscovery: query all other Discovery
RemoteDiscovery -> LocalDiscovery: combine the query results
LocalDiscovery -> NearbyBroker: <ID, brokerIP> of all matched entities
NearbyBroker -> RemoteBroker: fetch the matched entities
NearbyBroker -> App: return the matched entities


== query entities with a local Scope ==

App -> NearbyBroker: NGSI10 query entities with Scope (local)

NearbyBroker -> LocalDiscovery: NGSI9 query for S
LocalDiscovery -> LocalDiscovery: look up matched entities
LocalDiscovery -> NearbyBroker: <ID, brokerIP> of all matched entities
NearbyBroker -> RemoteBroker: fetch the matched entities
NearbyBroker -> App: return the matched entities


== query entities with a global Scope ==

App -> NearbyBroker: NGSI10 query entities with Scope S (global), topic T

NearbyBroker -> LocalDiscovery: NGSI9 query for <global, T>
LocalDiscovery -> LocalDiscovery: look up the routing table to identify which Discoverys are responsible for topic T
LocalDiscovery -> RemoteDiscovery: query all other Discovery
RemoteDiscovery -> LocalDiscovery: combine the query results
LocalDiscovery -> NearbyBroker: <ID, brokerIP> of all matched entities
NearbyBroker -> RemoteBroker: fetch the matched entities
NearbyBroker -> App: return the matched entities


== query entities with a polygon Scope and a topic==

App -> NearbyBroker: NGSI10 query entities with Scope S (polygon), Topic (T)

NearbyBroker -> LocalDiscovery: NGSI9 query for <S, T>
LocalDiscovery -> LocalDiscovery: look up the routing table to identify which Discoverys are responsible for <S, T>
LocalDiscovery -> RemoteDiscovery: query all other Discovery
RemoteDiscovery -> LocalDiscovery: combine the query results
LocalDiscovery -> NearbyBroker: <ID, brokerIP> of all matched entities
NearbyBroker -> RemoteBroker: fetch the matched entities
NearbyBroker -> App: return the matched entities

box "LocalSite"
participant NearbyBroker
participant LocalDiscovery
end box

box "RemoteSites" #LightBlue
participant RemoteBroker
participant RemoteDiscovery
end box
@enduml

PlantUML version 1.2018.09(Fri Jul 27 16:58:18 UTC 2018)
(GPL source distribution)
Java Runtime: Java(TM) SE Runtime Environment
JVM: Java HotSpot(TM) 64-Bit Server VM
Java Version: 1.7.0_25-b15
Operating System: Linux
Default Encoding: UTF-8
Language: en
Country: US
--></g></svg>