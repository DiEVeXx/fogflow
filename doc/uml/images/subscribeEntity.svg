<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="1314px" preserveAspectRatio="none" style="width:1555px;height:1314px;" version="1.1" viewBox="0 0 1555 1314" width="1555px" zoomAndPan="magnify"><defs><filter height="300%" id="fpgt4efbf03hg" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="136" x="705" y="22.9951">"subscribeEntity"</text><rect fill="#DDDDDD" height="1269.5078" style="stroke: #A80036; stroke-width: 1.0;" width="456" x="392.5" y="34.2969"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="66" x="587.5" y="46.3638">LocalSite</text><rect fill="#ADD8E6" height="1269.5078" style="stroke: #A80036; stroke-width: 1.0;" width="277" x="1265" y="34.2969"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="93" x="1357" y="46.3638">RemoteSites</text><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="30" x2="30" y1="88.7266" y2="1265.5078"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="452.5" x2="452.5" y1="88.7266" y2="1265.5078"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="784.5" x2="784.5" y1="88.7266" y2="1265.5078"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1328" x2="1328" y1="88.7266" y2="1265.5078"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1468" x2="1468" y1="88.7266" y2="1265.5078"/><rect fill="#FEFECE" filter="url(#fpgt4efbf03hg)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="41" x="8" y="53.4297"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="27" x="15" y="73.4248">App</text><rect fill="#FEFECE" filter="url(#fpgt4efbf03hg)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="41" x="8" y="1264.5078"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="27" x="15" y="1284.5029">App</text><rect fill="#FEFECE" filter="url(#fpgt4efbf03hg)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="108" x="396.5" y="53.4297"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="94" x="403.5" y="73.4248">NearbyBroker</text><rect fill="#FEFECE" filter="url(#fpgt4efbf03hg)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="108" x="396.5" y="1264.5078"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="94" x="403.5" y="1284.5029">NearbyBroker</text><rect fill="#FEFECE" filter="url(#fpgt4efbf03hg)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="116" x="724.5" y="53.4297"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="102" x="731.5" y="73.4248">LocalDiscovery</text><rect fill="#FEFECE" filter="url(#fpgt4efbf03hg)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="116" x="724.5" y="1264.5078"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="102" x="731.5" y="1284.5029">LocalDiscovery</text><rect fill="#FEFECE" filter="url(#fpgt4efbf03hg)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="115" x="1269" y="53.4297"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="101" x="1276" y="73.4248">RemoteBroker</text><rect fill="#FEFECE" filter="url(#fpgt4efbf03hg)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="115" x="1269" y="1264.5078"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="101" x="1276" y="1284.5029">RemoteBroker</text><rect fill="#FEFECE" filter="url(#fpgt4efbf03hg)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="136" x="1398" y="53.4297"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="122" x="1405" y="73.4248">RemoteDiscovery</text><rect fill="#FEFECE" filter="url(#fpgt4efbf03hg)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="136" x="1398" y="1264.5078"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="122" x="1405" y="1284.5029">RemoteDiscovery</text><rect fill="#EEEEEE" filter="url(#fpgt4efbf03hg)" height="3" style="stroke: #EEEEEE; stroke-width: 1.0;" width="1540" x="3" y="119.293"/><line style="stroke: #000000; stroke-width: 1.0;" x1="3" x2="1543" y1="119.293" y2="119.293"/><line style="stroke: #000000; stroke-width: 1.0;" x1="3" x2="1543" y1="122.293" y2="122.293"/><rect fill="#EEEEEE" filter="url(#fpgt4efbf03hg)" height="23.1328" style="stroke: #000000; stroke-width: 2.0;" width="315" x="615.5" y="108.7266"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="296" x="621.5" y="124.7935">subscribe entities with a polygon Scope</text><polygon fill="#A80036" points="440.5,158.9922,450.5,162.9922,440.5,166.9922,444.5,162.9922" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="30.5" x2="446.5" y1="162.9922" y2="162.9922"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="37.5" y="157.9263">1</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="314" x="50.5" y="157.9263">NGSI10 subscribe entities with Scope S (polygon)</text><polygon fill="#A80036" points="772.5,188.125,782.5,192.125,772.5,196.125,776.5,192.125" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="452.5" x2="778.5" y1="192.125" y2="192.125"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="459.5" y="187.0591">2</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="139" x="472.5" y="187.0591">NGSI9 subscribe for S</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="784.5" x2="826.5" y1="221.2578" y2="221.2578"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="826.5" x2="826.5" y1="221.2578" y2="234.2578"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="785.5" x2="826.5" y1="234.2578" y2="234.2578"/><polygon fill="#A80036" points="795.5,230.2578,785.5,234.2578,795.5,238.2578,791.5,234.2578" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="791.5" y="216.1919">3</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="471" x="804.5" y="216.1919">look up the routing table to identify which Discoverys are responsible for S</text><polygon fill="#A80036" points="1456,259.3906,1466,263.3906,1456,267.3906,1460,263.3906" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="784.5" x2="1462" y1="263.3906" y2="263.3906"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="791.5" y="258.3247">4</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="183" x="804.5" y="258.3247">subscribe all other Discovery</text><polygon fill="#A80036" points="795.5,288.5234,785.5,292.5234,795.5,296.5234,791.5,292.5234" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="789.5" x2="1467" y1="292.5234" y2="292.5234"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="801.5" y="287.4575">5</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="198" x="814.5" y="287.4575">send back the matched results</text><polygon fill="#A80036" points="463.5,317.6563,453.5,321.6563,463.5,325.6563,459.5,321.6563" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="457.5" x2="783.5" y1="321.6563" y2="321.6563"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="469.5" y="316.5903">6</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="286" x="482.5" y="316.5903">inform &lt;ID, brokerIP&gt; of all matched entities</text><polygon fill="#A80036" points="1316.5,346.7891,1326.5,350.7891,1316.5,354.7891,1320.5,350.7891" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="452.5" x2="1322.5" y1="350.7891" y2="350.7891"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="459.5" y="345.7231">7</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="215" x="472.5" y="345.7231">subscribe to the matched entities</text><polygon fill="#A80036" points="463.5,375.9219,453.5,379.9219,463.5,383.9219,459.5,379.9219" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="457.5" x2="1327.5" y1="379.9219" y2="379.9219"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="469.5" y="374.856">8</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="285" x="482.5" y="374.856">receive the update of the subscribed entities</text><polygon fill="#A80036" points="41.5,405.0547,31.5,409.0547,41.5,413.0547,37.5,409.0547" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="35.5" x2="451.5" y1="409.0547" y2="409.0547"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="47.5" y="403.9888">9</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="250" x="60.5" y="403.9888">inform updates of the matched entities</text><rect fill="#EEEEEE" filter="url(#fpgt4efbf03hg)" height="3" style="stroke: #EEEEEE; stroke-width: 1.0;" width="1540" x="3" y="437.6211"/><line style="stroke: #000000; stroke-width: 1.0;" x1="3" x2="1543" y1="437.6211" y2="437.6211"/><line style="stroke: #000000; stroke-width: 1.0;" x1="3" x2="1543" y1="440.6211" y2="440.6211"/><rect fill="#EEEEEE" filter="url(#fpgt4efbf03hg)" height="23.1328" style="stroke: #000000; stroke-width: 2.0;" width="290" x="628" y="427.0547"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="271" x="634" y="443.1216">subscribe entities with a local Scope</text><polygon fill="#A80036" points="440.5,477.3203,450.5,481.3203,440.5,485.3203,444.5,481.3203" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="30.5" x2="446.5" y1="481.3203" y2="481.3203"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="37.5" y="476.2544">10</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="280" x="59.5" y="476.2544">NGSI10 subscribe entities with Scope (local)</text><polygon fill="#A80036" points="772.5,506.4531,782.5,510.4531,772.5,514.4531,776.5,510.4531" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="452.5" x2="778.5" y1="510.4531" y2="510.4531"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="459.5" y="505.3872">11</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="253" x="481.5" y="505.3872">NGSI9 subscribe, local subscription only</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="784.5" x2="826.5" y1="539.5859" y2="539.5859"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="826.5" x2="826.5" y1="539.5859" y2="552.5859"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="785.5" x2="826.5" y1="552.5859" y2="552.5859"/><polygon fill="#A80036" points="795.5,548.5859,785.5,552.5859,795.5,556.5859,791.5,552.5859" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="791.5" y="534.52">12</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="158" x="813.5" y="534.52">look up matched entities</text><polygon fill="#A80036" points="463.5,577.7188,453.5,581.7188,463.5,585.7188,459.5,581.7188" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="457.5" x2="783.5" y1="581.7188" y2="581.7188"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="469.5" y="576.6528">13</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="286" x="491.5" y="576.6528">inform &lt;ID, brokerIP&gt; of all matched entities</text><polygon fill="#A80036" points="41.5,606.8516,31.5,610.8516,41.5,614.8516,37.5,610.8516" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="35.5" x2="451.5" y1="610.8516" y2="610.8516"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="47.5" y="605.7856">14</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="250" x="69.5" y="605.7856">inform updates of the matched entities</text><rect fill="#EEEEEE" filter="url(#fpgt4efbf03hg)" height="3" style="stroke: #EEEEEE; stroke-width: 1.0;" width="1540" x="3" y="639.418"/><line style="stroke: #000000; stroke-width: 1.0;" x1="3" x2="1543" y1="639.418" y2="639.418"/><line style="stroke: #000000; stroke-width: 1.0;" x1="3" x2="1543" y1="642.418" y2="642.418"/><rect fill="#EEEEEE" filter="url(#fpgt4efbf03hg)" height="23.1328" style="stroke: #000000; stroke-width: 2.0;" width="302" x="622" y="628.8516"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="283" x="628" y="644.9185">subscribe entities with a global Scope</text><polygon fill="#A80036" points="440.5,679.1172,450.5,683.1172,440.5,687.1172,444.5,683.1172" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="30.5" x2="446.5" y1="683.1172" y2="683.1172"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="37.5" y="678.0513">15</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="352" x="59.5" y="678.0513">NGSI10 subscribe entities with Scope S (global), topic T</text><polygon fill="#A80036" points="772.5,708.25,782.5,712.25,772.5,716.25,776.5,712.25" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="452.5" x2="778.5" y1="712.25" y2="712.25"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="459.5" y="707.1841">16</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="205" x="481.5" y="707.1841">NGSI9 subscribe for &lt;global, T&gt;</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="784.5" x2="826.5" y1="741.3828" y2="741.3828"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="826.5" x2="826.5" y1="741.3828" y2="754.3828"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="785.5" x2="826.5" y1="754.3828" y2="754.3828"/><polygon fill="#A80036" points="795.5,750.3828,785.5,754.3828,795.5,758.3828,791.5,754.3828" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="791.5" y="736.3169">17</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="504" x="813.5" y="736.3169">look up the routing table to identify which Discoverys are responsible for topic T</text><polygon fill="#A80036" points="1456,779.5156,1466,783.5156,1456,787.5156,1460,783.5156" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="784.5" x2="1462" y1="783.5156" y2="783.5156"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="791.5" y="778.4497">18</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="200" x="813.5" y="778.4497">subscribe to all other Discovery</text><polygon fill="#A80036" points="795.5,808.6484,785.5,812.6484,795.5,816.6484,791.5,812.6484" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="789.5" x2="1467" y1="812.6484" y2="812.6484"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="801.5" y="807.5825">19</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="178" x="823.5" y="807.5825">inform the matched entities</text><polygon fill="#A80036" points="463.5,837.7813,453.5,841.7813,463.5,845.7813,459.5,841.7813" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="457.5" x2="783.5" y1="841.7813" y2="841.7813"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="469.5" y="836.7153">20</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="286" x="491.5" y="836.7153">inform &lt;ID, brokerIP&gt; of all matched entities</text><polygon fill="#A80036" points="1316.5,866.9141,1326.5,870.9141,1316.5,874.9141,1320.5,870.9141" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="452.5" x2="1322.5" y1="870.9141" y2="870.9141"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="459.5" y="865.8481">21</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="215" x="481.5" y="865.8481">subscribe to the matched entities</text><polygon fill="#A80036" points="463.5,896.0469,453.5,900.0469,463.5,904.0469,459.5,900.0469" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="457.5" x2="1327.5" y1="900.0469" y2="900.0469"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="469.5" y="894.981">22</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="250" x="491.5" y="894.981">inform updates of the matched entities</text><polygon fill="#A80036" points="41.5,925.1797,31.5,929.1797,41.5,933.1797,37.5,929.1797" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="35.5" x2="451.5" y1="929.1797" y2="929.1797"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="47.5" y="924.1138">23</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="256" x="69.5" y="924.1138">forward updates of the matched entities</text><rect fill="#EEEEEE" filter="url(#fpgt4efbf03hg)" height="3" style="stroke: #EEEEEE; stroke-width: 1.0;" width="1540" x="3" y="957.7461"/><line style="stroke: #000000; stroke-width: 1.0;" x1="3" x2="1543" y1="957.7461" y2="957.7461"/><line style="stroke: #000000; stroke-width: 1.0;" x1="3" x2="1543" y1="960.7461" y2="960.7461"/><rect fill="#EEEEEE" filter="url(#fpgt4efbf03hg)" height="23.1328" style="stroke: #000000; stroke-width: 2.0;" width="399" x="573.5" y="947.1797"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="385" x="579.5" y="963.2466">subscribe entities with a polygon Scope and a topic</text><polygon fill="#A80036" points="440.5,997.4453,450.5,1001.4453,440.5,1005.4453,444.5,1001.4453" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="30.5" x2="446.5" y1="1001.4453" y2="1001.4453"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="37.5" y="996.3794">24</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="376" x="59.5" y="996.3794">NGSI10 subscribe entities with Scope S (polygon), Topic (T)</text><polygon fill="#A80036" points="772.5,1026.5781,782.5,1030.5781,772.5,1034.5781,776.5,1030.5781" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="452.5" x2="778.5" y1="1030.5781" y2="1030.5781"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="459.5" y="1025.5122">25</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="176" x="481.5" y="1025.5122">NGSI9 subscribe for &lt;S, T&gt;</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="784.5" x2="826.5" y1="1059.7109" y2="1059.7109"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="826.5" x2="826.5" y1="1059.7109" y2="1072.7109"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="785.5" x2="826.5" y1="1072.7109" y2="1072.7109"/><polygon fill="#A80036" points="795.5,1068.7109,785.5,1072.7109,795.5,1076.7109,791.5,1072.7109" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="791.5" y="1054.645">26</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="508" x="813.5" y="1054.645">look up the routing table to identify which Discoverys are responsible for &lt;S, T&gt;</text><polygon fill="#A80036" points="1456,1097.8438,1466,1101.8438,1456,1105.8438,1460,1101.8438" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="784.5" x2="1462" y1="1101.8438" y2="1101.8438"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="791.5" y="1096.7778">27</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="200" x="813.5" y="1096.7778">subscribe to all other Discovery</text><polygon fill="#A80036" points="795.5,1126.9766,785.5,1130.9766,795.5,1134.9766,791.5,1130.9766" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="789.5" x2="1467" y1="1130.9766" y2="1130.9766"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="801.5" y="1125.9106">28</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="178" x="823.5" y="1125.9106">inform the matched entities</text><polygon fill="#A80036" points="463.5,1156.1094,453.5,1160.1094,463.5,1164.1094,459.5,1160.1094" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="457.5" x2="783.5" y1="1160.1094" y2="1160.1094"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="469.5" y="1155.0435">29</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="286" x="491.5" y="1155.0435">inform &lt;ID, brokerIP&gt; of all matched entities</text><polygon fill="#A80036" points="1316.5,1185.2422,1326.5,1189.2422,1316.5,1193.2422,1320.5,1189.2422" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="452.5" x2="1322.5" y1="1189.2422" y2="1189.2422"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="459.5" y="1184.1763">30</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="215" x="481.5" y="1184.1763">subscribe to the matched entities</text><polygon fill="#A80036" points="463.5,1214.375,453.5,1218.375,463.5,1222.375,459.5,1218.375" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="457.5" x2="1327.5" y1="1218.375" y2="1218.375"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="469.5" y="1213.3091">31</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="250" x="491.5" y="1213.3091">inform updates of the matched entities</text><polygon fill="#A80036" points="41.5,1243.5078,31.5,1247.5078,41.5,1251.5078,37.5,1247.5078" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="35.5" x2="451.5" y1="1247.5078" y2="1247.5078"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="47.5" y="1242.4419">32</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="256" x="69.5" y="1242.4419">forward updates of the matched entities</text><!--
@startuml
title "subscribeEntity"

autonumber

== subscribe entities with a polygon Scope ==

App -> NearbyBroker: NGSI10 subscribe entities with Scope S (polygon)

NearbyBroker -> LocalDiscovery: NGSI9 subscribe for S
LocalDiscovery -> LocalDiscovery: look up the routing table to identify which Discoverys are responsible for S
LocalDiscovery -> RemoteDiscovery: subscribe all other Discovery
RemoteDiscovery -> LocalDiscovery: send back the matched results
LocalDiscovery -> NearbyBroker: inform <ID, brokerIP> of all matched entities
NearbyBroker -> RemoteBroker: subscribe to the matched entities
RemoteBroker -> NearbyBroker: receive the update of the subscribed entities
NearbyBroker -> App: inform updates of the matched entities


== subscribe entities with a local Scope ==

App -> NearbyBroker: NGSI10 subscribe entities with Scope (local)

NearbyBroker -> LocalDiscovery: NGSI9 subscribe, local subscription only
LocalDiscovery -> LocalDiscovery: look up matched entities
LocalDiscovery -> NearbyBroker: inform <ID, brokerIP> of all matched entities
NearbyBroker -> App: inform updates of the matched entities


== subscribe entities with a global Scope ==

App -> NearbyBroker: NGSI10 subscribe entities with Scope S (global), topic T

NearbyBroker -> LocalDiscovery: NGSI9 subscribe for <global, T>
LocalDiscovery -> LocalDiscovery: look up the routing table to identify which Discoverys are responsible for topic T
LocalDiscovery -> RemoteDiscovery: subscribe to all other Discovery
RemoteDiscovery -> LocalDiscovery: inform the matched entities
LocalDiscovery -> NearbyBroker: inform <ID, brokerIP> of all matched entities
NearbyBroker -> RemoteBroker: subscribe to the matched entities
RemoteBroker -> NearbyBroker: inform updates of the matched entities
NearbyBroker -> App: forward updates of the matched entities


== subscribe entities with a polygon Scope and a topic==

App -> NearbyBroker: NGSI10 subscribe entities with Scope S (polygon), Topic (T)

NearbyBroker -> LocalDiscovery: NGSI9 subscribe for <S, T>
LocalDiscovery -> LocalDiscovery: look up the routing table to identify which Discoverys are responsible for <S, T>
LocalDiscovery -> RemoteDiscovery: subscribe to all other Discovery
RemoteDiscovery -> LocalDiscovery: inform the matched entities
LocalDiscovery -> NearbyBroker: inform <ID, brokerIP> of all matched entities
NearbyBroker -> RemoteBroker: subscribe to the matched entities
RemoteBroker -> NearbyBroker: inform updates of the matched entities
NearbyBroker -> App: forward updates of the matched entities

box "LocalSite"
participant NearbyBroker
participant LocalDiscovery
end box

box "RemoteSites" #LightBlue
participant RemoteBroker
participant RemoteDiscovery
end box
@enduml

PlantUML version 1.2018.09(Fri Jul 27 16:58:18 UTC 2018)
(GPL source distribution)
Java Runtime: Java(TM) SE Runtime Environment
JVM: Java HotSpot(TM) 64-Bit Server VM
Java Version: 1.7.0_25-b15
Operating System: Linux
Default Encoding: UTF-8
Language: en
Country: US
--></g></svg>