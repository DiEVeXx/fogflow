<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="833px" preserveAspectRatio="none" style="width:1371px;height:833px;" version="1.1" viewBox="0 0 1371 833" width="1371px" zoomAndPan="magnify"><defs><filter height="300%" id="f2586wa9pweun" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="113" x="624.5" y="22.9951">"updateEntity"</text><rect fill="#DDDDDD" height="788.3828" style="stroke: #A80036; stroke-width: 1.0;" width="485" x="299.5" y="34.2969"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="66" x="509" y="46.3638">LocalSite</text><rect fill="#ADD8E6" height="788.3828" style="stroke: #A80036; stroke-width: 1.0;" width="277" x="1081" y="34.2969"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="93" x="1173" y="46.3638">RemoteSites</text><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="30" x2="30" y1="88.7266" y2="784.3828"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="359.5" x2="359.5" y1="88.7266" y2="784.3828"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="720.5" x2="720.5" y1="88.7266" y2="784.3828"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1144" x2="1144" y1="88.7266" y2="784.3828"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1284" x2="1284" y1="88.7266" y2="784.3828"/><rect fill="#FEFECE" filter="url(#f2586wa9pweun)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="41" x="8" y="53.4297"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="27" x="15" y="73.4248">App</text><rect fill="#FEFECE" filter="url(#f2586wa9pweun)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="41" x="8" y="783.3828"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="27" x="15" y="803.3779">App</text><rect fill="#FEFECE" filter="url(#f2586wa9pweun)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="108" x="303.5" y="53.4297"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="94" x="310.5" y="73.4248">NearbyBroker</text><rect fill="#FEFECE" filter="url(#f2586wa9pweun)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="108" x="303.5" y="783.3828"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="94" x="310.5" y="803.3779">NearbyBroker</text><rect fill="#FEFECE" filter="url(#f2586wa9pweun)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="116" x="660.5" y="53.4297"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="102" x="667.5" y="73.4248">LocalDiscovery</text><rect fill="#FEFECE" filter="url(#f2586wa9pweun)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="116" x="660.5" y="783.3828"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="102" x="667.5" y="803.3779">LocalDiscovery</text><rect fill="#FEFECE" filter="url(#f2586wa9pweun)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="115" x="1085" y="53.4297"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="101" x="1092" y="73.4248">RemoteBroker</text><rect fill="#FEFECE" filter="url(#f2586wa9pweun)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="115" x="1085" y="783.3828"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="101" x="1092" y="803.3779">RemoteBroker</text><rect fill="#FEFECE" filter="url(#f2586wa9pweun)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="136" x="1214" y="53.4297"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="122" x="1221" y="73.4248">RemoteDiscovery</text><rect fill="#FEFECE" filter="url(#f2586wa9pweun)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="136" x="1214" y="783.3828"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="122" x="1221" y="803.3779">RemoteDiscovery</text><rect fill="#EEEEEE" filter="url(#f2586wa9pweun)" height="3" style="stroke: #EEEEEE; stroke-width: 1.0;" width="1356" x="3" y="119.293"/><line style="stroke: #000000; stroke-width: 1.0;" x1="3" x2="1359" y1="119.293" y2="119.293"/><line style="stroke: #000000; stroke-width: 1.0;" x1="3" x2="1359" y1="122.293" y2="122.293"/><rect fill="#EEEEEE" filter="url(#f2586wa9pweun)" height="23.1328" style="stroke: #000000; stroke-width: 2.0;" width="236" x="563" y="108.7266"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="212" x="569" y="124.7935">update entity with location x</text><polygon fill="#A80036" points="347.5,158.9922,357.5,162.9922,347.5,166.9922,351.5,162.9922" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="30.5" x2="353.5" y1="162.9922" y2="162.9922"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="37.5" y="157.9263">1</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="191" x="50.5" y="157.9263">update entity E with location x</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="359.5" x2="401.5" y1="192.125" y2="192.125"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="401.5" x2="401.5" y1="192.125" y2="205.125"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="360.5" x2="401.5" y1="205.125" y2="205.125"/><polygon fill="#A80036" points="370.5,201.125,360.5,205.125,370.5,209.125,366.5,205.125" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="366.5" y="187.0591">2</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="201" x="379.5" y="187.0591">check if the entity exists locally;</text><polygon fill="#A80036" points="708.5,230.2578,718.5,234.2578,708.5,238.2578,712.5,234.2578" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="359.5" x2="714.5" y1="234.2578" y2="234.2578"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="366.5" y="229.1919">3</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="314" x="379.5" y="229.1919">if yes, update it locally and update its registration</text><polygon fill="#A80036" points="1272,259.3906,1282,263.3906,1272,267.3906,1276,263.3906" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="720.5" x2="1278" y1="263.3906" y2="263.3906"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="727.5" y="258.3247">4</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="397" x="740.5" y="258.3247">announce the topic of this entity if it is new in the routing table</text><polygon fill="#A80036" points="708.5,288.5234,718.5,292.5234,708.5,296.5234,712.5,292.5234" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="359.5" x2="714.5" y1="292.5234" y2="292.5234"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="366.5" y="287.4575">5</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="324" x="379.5" y="287.4575">otherwise, find out which broker is responsible for x</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="720.5" x2="762.5" y1="321.6563" y2="321.6563"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="762.5" x2="762.5" y1="321.6563" y2="334.6563"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="721.5" x2="762.5" y1="334.6563" y2="334.6563"/><polygon fill="#A80036" points="731.5,330.6563,721.5,334.6563,731.5,338.6563,727.5,334.6563" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="727.5" y="316.5903">6</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="242" x="740.5" y="316.5903">look up the routing table for location x</text><polygon fill="#A80036" points="370.5,359.7891,360.5,363.7891,370.5,367.7891,366.5,363.7891" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="364.5" x2="719.5" y1="363.7891" y2="363.7891"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="376.5" y="358.7231">7</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="104" x="389.5" y="358.7231">a remote broker</text><polygon fill="#A80036" points="1132.5,388.9219,1142.5,392.9219,1132.5,396.9219,1136.5,392.9219" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="359.5" x2="1138.5" y1="392.9219" y2="392.9219"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="366.5" y="387.856">8</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="218" x="379.5" y="387.856">send update to the remote broker</text><rect fill="#EEEEEE" filter="url(#f2586wa9pweun)" height="3" style="stroke: #EEEEEE; stroke-width: 1.0;" width="1356" x="3" y="421.4883"/><line style="stroke: #000000; stroke-width: 1.0;" x1="3" x2="1359" y1="421.4883" y2="421.4883"/><line style="stroke: #000000; stroke-width: 1.0;" x1="3" x2="1359" y1="424.4883" y2="424.4883"/><rect fill="#EEEEEE" filter="url(#f2586wa9pweun)" height="23.1328" style="stroke: #000000; stroke-width: 2.0;" width="215" x="573.5" y="410.9219"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="191" x="579.5" y="426.9888">update entity with topic T</text><polygon fill="#A80036" points="347.5,461.1875,357.5,465.1875,347.5,469.1875,351.5,465.1875" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="30.5" x2="353.5" y1="465.1875" y2="465.1875"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="37.5" y="460.1216">9</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="292" x="50.5" y="460.1216">update entity E with topic T, without location X</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="359.5" x2="401.5" y1="494.3203" y2="494.3203"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="401.5" x2="401.5" y1="494.3203" y2="507.3203"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="360.5" x2="401.5" y1="507.3203" y2="507.3203"/><polygon fill="#A80036" points="370.5,503.3203,360.5,507.3203,370.5,511.3203,366.5,507.3203" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="366.5" y="489.2544">10</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="324" x="388.5" y="489.2544">create/update it locally, assume the scope is 'local'</text><polygon fill="#A80036" points="708.5,532.4531,718.5,536.4531,708.5,540.4531,712.5,536.4531" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="359.5" x2="714.5" y1="536.4531" y2="536.4531"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="366.5" y="531.3872">11</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="141" x="388.5" y="531.3872">update its registration</text><polygon fill="#A80036" points="1272,561.5859,1282,565.5859,1272,569.5859,1276,565.5859" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="720.5" x2="1278" y1="565.5859" y2="565.5859"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="727.5" y="560.52">12</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="397" x="749.5" y="560.52">announce the topic of this entity if it is new in the routing table</text><polygon fill="#A80036" points="347.5,590.7188,357.5,594.7188,347.5,598.7188,351.5,594.7188" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="30.5" x2="353.5" y1="594.7188" y2="594.7188"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="37.5" y="589.6528">13</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="182" x="59.5" y="589.6528">update intent E with scope S</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="359.5" x2="401.5" y1="623.8516" y2="623.8516"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="401.5" x2="401.5" y1="623.8516" y2="636.8516"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="360.5" x2="401.5" y1="636.8516" y2="636.8516"/><polygon fill="#A80036" points="370.5,632.8516,360.5,636.8516,370.5,640.8516,366.5,636.8516" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="366.5" y="618.7856">14</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="207" x="388.5" y="618.7856">check if S is within its own region</text><polygon fill="#A80036" points="708.5,661.9844,718.5,665.9844,708.5,669.9844,712.5,665.9844" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="359.5" x2="714.5" y1="665.9844" y2="665.9844"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="366.5" y="660.9185">15</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="213" x="388.5" y="660.9185">otherwise, ask the local discovery</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="720.5" x2="762.5" y1="695.1172" y2="695.1172"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="762.5" x2="762.5" y1="695.1172" y2="708.1172"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="721.5" x2="762.5" y1="708.1172" y2="708.1172"/><polygon fill="#A80036" points="731.5,704.1172,721.5,708.1172,731.5,712.1172,727.5,708.1172" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="727.5" y="690.0513">16</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="388" x="749.5" y="690.0513">look up the broker(s) responsible for S from the routing table</text><polygon fill="#A80036" points="370.5,733.25,360.5,737.25,370.5,741.25,366.5,737.25" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="364.5" x2="719.5" y1="737.25" y2="737.25"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="376.5" y="732.1841">17</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="126" x="398.5" y="732.1841">a set of brokers, BS</text><polygon fill="#A80036" points="1132.5,762.3828,1142.5,766.3828,1132.5,770.3828,1136.5,766.3828" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="359.5" x2="1138.5" y1="766.3828" y2="766.3828"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="366.5" y="761.3169">18</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="192" x="388.5" y="761.3169">forward the intent entity to BS</text><!--
@startuml
title "updateEntity"

autonumber

== update entity with location x  ==


App -> NearbyBroker: update entity E with location x 


NearbyBroker -> NearbyBroker: check if the entity exists locally; 

NearbyBroker -> LocalDiscovery: if yes, update it locally and update its registration
LocalDiscovery -> RemoteDiscovery: announce the topic of this entity if it is new in the routing table


NearbyBroker -> LocalDiscovery: otherwise, find out which broker is responsible for x
LocalDiscovery -> LocalDiscovery: look up the routing table for location x
LocalDiscovery -> NearbyBroker: a remote broker

NearbyBroker -> RemoteBroker: send update to the remote broker


== update entity with topic T  ==

App -> NearbyBroker: update entity E with topic T, without location X
NearbyBroker -> NearbyBroker: create/update it locally, assume the scope is 'local'

NearbyBroker -> LocalDiscovery: update its registration
LocalDiscovery -> RemoteDiscovery: announce the topic of this entity if it is new in the routing table

App -> NearbyBroker: update intent E with scope S
NearbyBroker -> NearbyBroker: check if S is within its own region
NearbyBroker -> LocalDiscovery: otherwise, ask the local discovery
LocalDiscovery -> LocalDiscovery: look up the broker(s) responsible for S from the routing table
LocalDiscovery -> NearbyBroker: a set of brokers, BS

NearbyBroker -> RemoteBroker: forward the intent entity to BS


box "LocalSite"
participant NearbyBroker
participant LocalDiscovery
end box

box "RemoteSites" #LightBlue
participant RemoteBroker
participant RemoteDiscovery
end box
@enduml

PlantUML version 1.2018.09(Fri Jul 27 16:58:18 UTC 2018)
(GPL source distribution)
Java Runtime: Java(TM) SE Runtime Environment
JVM: Java HotSpot(TM) 64-Bit Server VM
Java Version: 1.7.0_25-b15
Operating System: Linux
Default Encoding: UTF-8
Language: en
Country: US
--></g></svg>